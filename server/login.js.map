{"version":3,"file":"login.js","sources":["webpack:///src/shared/Login.js","webpack:///src/actions/login/login.js"],"sourcesContent":["import React from 'react';\nimport {\n\tmatch,\n\tRoutingContext,\n\tRouter,\n\tRoute,\n\tIndexRoute,\n\tIndexRedirect,\n\tRedirect,\n\tLink,\n\tbrowserHistory\n} from 'react-router';\n\nimport cookie from 'react-cookies';\n\n\n\n// require('isomorphic-fetch');\n\nimport 'isomorphic-fetch';\n\n\n/**\n * 后加的\n */\n\nimport {\n\tconnect\n} from 'react-redux';\n\nimport {\n\tbindActionCreators\n} from 'redux';\n\n\nimport * as actionCreators from '../actions/login/login';\n\n\nfunction toQueryString(obj) {\n\treturn obj ? Object.keys(obj).sort().map(function(key) {\n\t\tvar val = obj[key];\n\t\tif (Array.isArray(val)) {\n\t\t\treturn val.sort().map(function(val2) {\n\t\t\t\treturn encodeURIComponent(key) + '=' + encodeURIComponent(val2);\n\t\t\t}).join('&');\n\t\t}\n\t\treturn encodeURIComponent(key) + '=' + encodeURIComponent(val);\n\t}).join('&') : '';\n}\n\n\nimport logo from './logo.svg';\n\nclass Login extends React.Component {\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t}\n\n\tcomponentWillMount() {\n\t\tcookie.remove('token', {\n\t\t\tpath: '/'\n\t\t});\n\n\n\t}\n\tcomponentDidMount() {\n\t\t// console.log(12);\n\n\t\t// this.getLogin();\n\n\t}\n\n\n\tgetLogin1() {\n\t\tvar user = this.refs.user.value;\n\t\tvar pass = this.refs.pass.value;\n\t\tthis.props.LoginToken(user, pass, this.props);\n\t}\n\n\tgetLogin() {\n\t\tvar user = this.refs.user.value;\n\t\tvar pass = this.refs.pass.value;\n\n\t\tfetch(\"http://127.0.0.1:3001/token\", {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tmode: 'cors',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t\t},\n\t\t\t\tbody: toQueryString({\n\t\t\t\t\tusername: user,\n\t\t\t\t\tpassword: pass\n\t\t\t\t})\n\t\t\t})\n\t\t\t.then(res => res.json())\n\t\t\t.then(res => {\n\n\t\t\t\tif (res.status) {\n\t\t\t\t\tcookie.save('token', res.token, {\n\t\t\t\t\t\tpath: '/'\n\t\t\t\t\t});\n\n\t\t\t\t\t//登录成功跳转到默认页面\n\t\t\t\t\t// console.log(this.props.router.push('/data/userprofile'));\n\n\t\t\t\t\tthis.props.router.push('/');\n\t\t\t\t} else {\n\t\t\t\t\t//todo 失败弹出层\n\t\t\t\t\talert('用户名或密码错误');\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\trender() {\n\n\n\n\t\tconsole.log(this.props, 'login props')\n\n\t\treturn (\n\n\n\t\t\t<div className=\"App\">\n\t\t\t\t<div className=\"App-header\">\n\t\t\t\t\t<img src={logo} className=\"App-logo\" alt=\"logo\" />\n\t\t\t\t\t<h2>react同构直出demo</h2>\n\t\t\t\t</div>\n\t\t\t\t<p className=\"App-intro\">是不是很酷？ 登录页</p>\n\t\t\t\t<div className=\"left\">\n\t\t\t\t\t<Link to=\"/\">用户概况</Link>\n\t\t\t\t\t<Link to=\"/kpireport\">KPI报表</Link>\n\t\t\t\t\t<Link to =\"/login\">登录</Link>\n\t\t\t\t\t\n\t\t\t\t\t<Link to =\"/getdata\">开放型数据</Link>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<div>\n\t\t\t\t\t<label>用户名：</label><input type=\"text\" ref=\"user\" />\t\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<div>\n\t\t\t\t\t<label>密码：</label><input type=\"password\" ref=\"pass\" />\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div style={{marginTop:\"20px\"}}>\n\t\t\t\t\t<button onClick={this.getLogin1.bind(this)}>登录</button>\n\t\t\t\t\t{/*<button onClick={this.props.LoginToken(this)}>登录</button>*/}\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t);\n\t}\n}\n\nconst mapStateToProps = (state) => {\n\tconsole.log(state, 'statestate');\n\treturn {\n\t\tlogin: state.Login.login\n\t}\n};\n\nconst mapDispatchToProps = (dispatch, ownProps) => {\n\treturn bindActionCreators(actionCreators, dispatch);\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Login);\n\n\n// WEBPACK FOOTER //\n// src/shared/Login.js","\timport cookie from 'react-cookies';\n\n\n\n\t// require('isomorphic-fetch');\n\n\timport 'isomorphic-fetch';\n\n\tfunction toQueryString(obj) {\n\t\treturn obj ? Object.keys(obj).sort().map(function(key) {\n\t\t\tvar val = obj[key];\n\t\t\tif (Array.isArray(val)) {\n\t\t\t\treturn val.sort().map(function(val2) {\n\t\t\t\t\treturn encodeURIComponent(key) + '=' + encodeURIComponent(val2);\n\t\t\t\t}).join('&');\n\t\t\t}\n\t\t\treturn encodeURIComponent(key) + '=' + encodeURIComponent(val);\n\t\t}).join('&') : '';\n\t}\n\n\n\texport const LoginToken = (user, pass, props) => {\n\n\t\t// console.log(this, 'actions this');\n\n\t\tconsole.log(user, '用户名');\n\t\tconsole.log(pass, '密码');\n\n\t\treturn function(dispatch) {\n\n\t\t\t// var user = this.refs.user.value;\n\t\t\t// var pass = this.refs.pass.value;\n\n\t\t\treturn fetch(\"http://127.0.0.1:3001/token\", {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tmode: 'cors',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t\t},\n\t\t\t\tbody: toQueryString({\n\t\t\t\t\tusername: user,\n\t\t\t\t\tpassword: pass\n\t\t\t\t})\n\t\t\t}).then(function(res) {\n\n\t\t\t\t// res.status = 200;\n\t\t\t\tres.json().then(res => {\n\n\t\t\t\t\tif (res.status) {\n\t\t\t\t\t\tcookie.save('token', res.token, {\n\t\t\t\t\t\t\tpath: '/'\n\t\t\t\t\t\t});\n\n\n\t\t\t\t\t\tdispatch({\n\t\t\t\t\t\t\ttype: \"login\",\n\t\t\t\t\t\t\tpayload: true\n\t\t\t\t\t\t});\n\t\t\t\t\t\t//登录成功跳转到默认页面\n\t\t\t\t\t\t// console.log(this.props.router.push('/data/userprofile'));\n\n\t\t\t\t\t\t// this.props.router.push('/');\n\t\t\t\t\t\tprops.router.push('/');\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//todo 失败弹出层\n\t\t\t\t\t\talert('用户名或密码错误');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}.bind(this));\n\t\t};\n\t};\n\n\n// WEBPACK FOOTER //\n// src/actions/login/login.js"],"mappings":";A;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AAWA;AACA;AAGA;AACA;AACA;AACA;AAEA;;;;AAIA;AACA;AAGA;AACA;AAIA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;AAEA;AAAA;AACA;AADA;AAEA;AACA;;;AACA;AACA;AACA;AADA;AAKA;;;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;;AAEA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AAFA;AANA;AAWA;AAAA;AACA;AAEA;AACA;AACA;AADA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AAGA;AACA;AACA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AALA;AAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AATA;AAbA;AAgCA;;;;AAtGA;AACA;AAwGA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACzKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AAFA;AANA;AACA;AAWA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}